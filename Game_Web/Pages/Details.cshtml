@page
@model DetailsModel
@{
    ViewData["Title"] = "Game Details";
}

<link rel="stylesheet" href="~/css/Details.css" />

<div class="details-page">
    <section class="details-hero">
        @if (Model.Game.Picture != null && Model.Game.Picture.Length > 0)
        {
            <img src="data:image/png;base64,@Convert.ToBase64String(Model.Game.Picture)"
                 alt="@Model.Game.Name cover" />
        }
        else
        {
            <div class="details-hero-placeholder">
                No image
            </div>
        }
    </section>

    <section class="details-grid">

        <article class="details-card details-card--main">
            <div class="details-title">@Model.Game.Name</div>
            <div class="details-genre">Genre: @Model.Game.Category</div>

            <p class="details-desc">
                @Model.Game.Description
            </p>
        </article>
        <aside class="details-card details-card--side">
            <div class="details-side-title">User Comments</div>

            @if (Model.Comments.Any())
            {
                @foreach (var comment in Model.Comments)
                {
                    <div class="comment">
                        <div class="avatar">
                            @Model.UserName.Substring(0, 1).ToUpper()
                        </div>

                        <div class="comment-body">
                            <div class="comment-header">
                                <span class="comment-name">@Model.UserName</span>
                                <span class="comment-score">@comment.Score/5</span>
                            </div>

                            <div class="comment-text">
                                @comment.Comment
                            </div>
                        </div>
                    </div>

                }
            }
            else
            {
                <p class="no-comments">No comments yet. Be the first to comment!</p>
            }
            @if (User.Identity?.IsAuthenticated == true)

            {
                <form method="post">
                    <input type="hidden" asp-for="Rating.GameId" />

                    <div class="add-comment">
                        <div class="add-comment-header">
                            <div class="add-comment-title">Leave a Comment</div>
                            <div class="rating-inline">
                                <input asp-for="Rating.Score"
                                       class="rating-input"
                                       type="number"
                                       min="0"
                                       max="5" />
                                <span class="rating-max">/5</span>
                            </div>
                        </div>

                        <textarea asp-for="Rating.Comment"
                                  class="add-comment-text"
                                  placeholder="Share your thoughts about this game..."
                                  rows="3"></textarea>
                        @if (!Model.HasUserCommented)
                        {
                            <button type="submit" class="comment-submit">
                                Post Comment
                            </button>
                        }
                        else
                        {
                            <p>You have already commented on this Game</p>
                        }
                    </div>
                </form>
            }
            else
            {
                <p>You must be logged in to comment.</p>
            }

        </aside>

    </section>
</div>
